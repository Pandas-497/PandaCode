<!DOCTYPE html>
<head>
    <title>PandaCode</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.png">
    <meta charset="utf-8">
    <meta name="author" content="Team Pandas">
    <meta name="description" content="Learn web programming!">
    <meta property="og:type" content="website">
    <meta property="og:title" content="PandaCode">
    <meta property="og:description" content="Learn web programming!">
    <meta property="og:image" content="favicon.png">
    <script>
        window.requestAnimFrame = (function(){
            // Glue code found on stackoverflow :)
            return window.requestAnimationFrame       
                || window.webkitRequestAnimationFrame 
                || window.mozRequestAnimationFrame    
                || ((callback) => window.setTimeout(callback, 1000 / 60));
        })();
      
        window.onload = () => {
            let theCanvas = document.getElementById("ui-canvas");

            var htmlInput = "<title>input</title>";
    
            function fitToContainer(canvas){
                // Make it visually fill the positioned parent
                canvas.style.width ='100%';
                canvas.style.height='100%';
                // ...then set the internal size to match
                canvas.width  = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }

            let theDisplay = document.getElementById("display");
            

            // Tracking mouse position. We can use mouse.x and mouse.y to get
            // mouse coordinates within to the canvas.
            let mouse = { x: 0, y: 0 };
            theCanvas.onmousemove = (e) => {
                mouse.x = e.offsetX;
                mouse.y = e.offsetY;
            };
            function isMouseIn(x, y, w, h) {
                return mouse.x >= x && mouse.y >= y 
                    && mouse.x <= x + w && mouse.y <= y + h;
            }

            function render(ctx) {
                // Example render behavior. We'll want to replace the button rendering
                // with something more sophisticated in the future.
                fitToContainer(theCanvas);
                
                // Clear canvas to start a new frame.
                ctx.clearRect(0, 0, ctx.width, ctx.height);

                // Draw button background.
                ctx.rect(8, 8, 120, 60);
                ctx.fillStyle = isMouseIn(8, 8, 120, 60) ? "blue" : "red";
                ctx.fill();

                // Draw button label.
                ctx.font = "12pt Montserrat";
                ctx.fillStyle = "black";
                ctx.fillText("Add Element", 16, 42);
            }

            theCanvas.onclick = (e) => {
                // Example click behavior. We'll want to replace this with something
                // more sophisticated later (like iterating through a button list).
                if (isMouseIn(8, 8, 120, 60)) theDisplay.innerHTML += "More text...<br>"
            }

            let downloadTab = document.getElementById("download-tab");
            downloadTab.onclick = (e) => {
                var html = theDisplay.innerHTML;
                var link = document.createElement('a');
                var fileName = 'pandaCode.html';

                link.setAttribute('download', fileName);
                link.setAttribute('href', 'data:text/plain;charset=utf-8, ' + encodeURIComponent(html));
                link.click();
            }
            let renderTab = document.getElementById("render-tab");
            // const fs = require('fs');
            renderTab.onclick = (e) => {
                // fs.writeFile('input.html', htmlInput, (err) => {
                //     if(err) throw err;
                // });

                let textDisplay = document.getElementById('display');
                let iframeDisplay = document.getElementById('render');

                if (textDisplay.style.display == 'block') {
                    textDisplay.style.display = 'none'
                    iframeDisplay.style.display = 'block'
                }
            }
            let htmlTab = document.getElementById("html-tab");
            htmlTab.onclick = (e) => {
                let textDisplay = document.getElementById('display');
                let iframeDisplay = document.getElementById('render');

                if (iframeDisplay.style.display == 'block') {
                    iframeDisplay.style.display = 'none'
                    textDisplay.style.display = 'block'
                }
            }
            
            (function renderFrame() {
                requestAnimationFrame(renderFrame);
                render(theCanvas.getContext("2d"));
            })();
        }
    </script>
</head>
<body>
    <div>
        <div style="display: inline-block; vertical-align: middle;">
            <img src="favicon.png" width="96px" height="96px">
        </div>  
        <div style="display: inline-block; vertical-align: middle;">
            <h1> Panda<span class="code-title">Code</span> </h1>
        </div>
    </div>
    <div class="panels">
        <div class="panel" id="layout-panel">
            <span class="panel-title">Layout</span><br>
            <canvas id="ui-canvas">
                <!-- Our GUI will be implemented in this canvas element. -->
            </canvas>
        </div><div class="panel" id="display-panel">
            <span class="panel-title">Display</span>
            <span class="panel-tab" id="download-tab">Download</span>
            <span class="panel-tab" id="render-tab">Render</span>
            <span class="panel-tab" id="html-tab">HTML</span><br>
            <div class="html-display">
                <div class="scrollbox">
                    <div class="display-body" id="display" style="display: block">
                        <!-- 
                            Whatever site preview or code display we want should
                            go in the innerHtml of this div. 
                        -->
                        Example text...<br>
                    </div>
                    <iframe id="render" src="input.html" width="99%" height="98%" style="display: none"></iframe>
                </div>
            </div>
        </div>
    </div>
</body>